<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1, maximum-scale=1">
    <title>Webby Mouse</title>
    <style>
      * { margin: 0; padding: 0; box-sizing: border-box; }
      body { font: 13px Helvetica, Arial; }
      .touchpad {position: fixed; display: block; width: 100%; height: 100%;};
    </style>
  </head>
  <body>
    <div id="touchpad" class="touchpad"></div>
    <script src="/public/vendor/jquery/dist/jquery.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script src="/public/vendor/hammerjs/hammer.min.js"></script>
    <script>
      var touchElem = document.getElementById('touchpad');
      var socket = io();
      var delta = null;
      var moving = false;

      var pos = {x: 0, y: 0, cmd: null};
      /**
       * pass `pos` object to socket.emit('mouse', pos) function
       *
       * {Object} pos
       * {integer} pos.x mouse x offset
       * {integer} pos.y mouse y offset
       * {string} pos.cmd key command or mouse click (not implemented yet)
       */
      var emitMouse = function(x, y, cmd) {
        pos.x = x;
        pos.y = y;
        pos.cmd = cmd;

        socket.emit('mouse', pos);
      };

      // receive msg
      //socket.on('mouse', function(msg) {
        //console.log(msg);
        //console.info(msg.x + ',' + msg.y);
      //});

      var hammer = new Hammer(touchElem);
      hammer.get('pan').set({ direction: Hammer.DIRECTION_ALL });
      hammer.on('panstart panend panup pandown panleft panright', function(e) {
        if (e.type == 'panstart') {
          delta = null;
          moving = true;
        }
        if (e.type == 'panend') {
          delta = null;
          moving = false;
        }
        if (moving && delta != null) {
          emitMouse(e.deltaX - delta.x, e.deltaY - delta.y, 'move');
        }
        delta = {x: e.deltaX, y: e.deltaY};
      });
      hammer.on('tap', function(e) {
        emitMouse(0, 0, 'tap');
      });
      
    </script>
  </body>
</html>

